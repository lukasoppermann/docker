# don't redirect proxy
proxy_redirect  off;
# turn off global logging
access_log off;
# globally enable gzip
gzip_types text/plain text/css application/javascript application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;
# include proxy presets
include /etc/nginx/proxy.conf;
# catch all to not allow unwanted domains
include /etc/nginx/catch.conf;
# general ssl parameters
include /etc/nginx/ssl-params.conf;

upstream api.formandsystem.dev {
    least_conn;
    server docker_api_1;
}

server {

    # listen 443;
    listen 80;
    server_name api.formandsystem.dev;

    access_log            /var/log/nginx/api.formandsystem.dev.access.log;

    location / {
      proxy_pass              http://$host$uri;
    }
}

upstream cms.formandsystem.dev {
    least_conn;
    server docker_cms_1;
}

server {

    # listen 443;
    listen 80;
    server_name cms.formandsystem.dev;

    access_log            /var/log/nginx/{{ $host }}.access.log;

    ssl_certificate /etc/letsencrypt/live/{{ $host }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ $host }}/privkey.pe

    location / {
      proxy_pass              http://$host$uri;
    }
}
